<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIUD 2025 - Programma Congresso</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #8B1538 0%, #B85450 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #8B1538 0%, #B85450 100%);
            color: white;
            padding: 0.75rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.3rem;
            margin-bottom: 0.25rem;
        }

        .header p {
            font-size: 0.8rem;
            opacity: 0.9;
            line-height: 1.2;
        }

        .filters {
            padding: 0.75rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            position: sticky;
            top: 80px;
            z-index: 99;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .filter-row-full {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .filter-dropdown {
            position: relative;
        }

        .dropdown-select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #8B1538;
            border-radius: 8px;
            background: white;
            color: #8B1538;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238B1538' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .dropdown-select:focus {
            outline: none;
            border-color: #B85450;
            box-shadow: 0 0 0 3px rgba(139, 21, 56, 0.1);
        }

        .search-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.6rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #8B1538;
            box-shadow: 0 0 0 3px rgba(139, 21, 56, 0.1);
        }

        .content {
            padding: 1rem;
        }

        .day-section {
            margin-bottom: 2rem;
        }

        .day-header {
            background: linear-gradient(135deg, #8B1538 0%, #B85450 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .day-header h2 {
            font-size: 1.3rem;
            margin-bottom: 0.25rem;
        }

        .day-header .date {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .time-slot-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .time-slot-info h3 {
            color: #1976d2;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .time-slot-info p {
            color: #666;
            font-size: 0.85rem;
            margin: 0;
        }

        .concurrent-sessions {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .session-card {
            background: white;
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            border-left: 4px solid #8B1538;
            position: relative;
        }

        .session-header {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .session-time {
            font-weight: 600;
            color: #8B1538;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .session-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .session-info {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .session-room, .session-type, .session-ecm {
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .session-room {
            background: #B85450;
            color: white;
        }

        .session-type {
            background: #e9ecef;
            color: #495057;
        }

        .session-ecm {
            background: #28a745;
            color: white;
        }

        .session-content {
            padding: 1rem;
        }

        .session-moderators {
            margin-bottom: 0.75rem;
        }

        .session-moderators strong {
            color: #8B1538;
        }

        .session-program {
            list-style: none;
        }

        .session-program li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f8f9fa;
            display: flex;
            gap: 0.75rem;
        }

        .session-program li:last-child {
            border-bottom: none;
        }

        .program-time {
            font-weight: 600;
            color: #8B1538;
            min-width: 50px;
            font-size: 0.9rem;
        }

        .program-item {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .favorite-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #ccc;
            transition: color 0.3s ease;
        }

        .favorite-btn.active {
            color: #ff6b6b;
        }

        .personal-program-toggle {
            position: fixed;
            bottom: 1.5rem;
            right: 1rem;
            background: #8B1538;
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(139, 21, 56, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .personal-program-toggle:active {
            transform: scale(0.95);
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            margin: 0.75rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            width: calc(100% - 1.5rem);
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.2rem;
            }
            
            .session-title {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>SIUD 2025</h1>
            <p>49¬∞ Congresso Nazionale SIUD<br>
            23¬∞ Congresso SIUD Fisioterapisti, Infermieri, Ostetriche<br>
            Bologna, 26-28 Giugno ‚Ä¢ Hotel Savoia Regency</p>
        </header>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-dropdown">
                    <select class="dropdown-select" id="dayFilter">
                        <option value="all">Tutti i giorni</option>
                        <option value="2025-06-26">Gio 26 Giugno</option>
                        <option value="2025-06-27">Ven 27 Giugno</option>
                        <option value="2025-06-28">Sab 28 Giugno</option>
                    </select>
                </div>
                
                <div class="filter-dropdown">
                    <select class="dropdown-select" id="timeSlotFilter">
                        <option value="all">Tutte le fasce orarie</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-row-full">
                <div class="filter-dropdown">
                    <select class="dropdown-select" id="roomFilter">
                        <option value="all">Tutte le sale</option>
                        <option value="auditorium">Auditorium</option>
                        <option value="napoleon">Sala Napoleon</option>
                        <option value="nettuno">Sala Nettuno</option>
                    </select>
                </div>
                
                <div class="filter-dropdown">
                    <select class="dropdown-select" id="typeFilter">
                        <option value="all">Tutte le tipologie</option>
                        <option value="workshop">Workshop</option>
                        <option value="lettura">Letture</option>
                        <option value="sessione">Sessioni</option>
                        <option value="abstract">Abstract</option>
                        <option value="sponsor">Sponsorizzate</option>
                    </select>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="üîç Cerca relatori, moderatori o argomenti...">
            </div>
        </div>

        <main class="content" id="programContent">
            <!-- Il contenuto verr√† generato dinamicamente -->
        </main>

        <button class="export-btn hidden" id="exportBtn">üì• Esporta Programma Personale</button>
        <button class="personal-program-toggle" id="personalToggle" title="Visualizza programma personale">‚≠ê</button>
    </div>

    <script>
        // Dati del programma (versione semplificata per test)
        const programData = [
            {
                date: "2025-06-26",
                dayName: "Gioved√¨ 26 Giugno",
                sessions: [
                    {
                        id: "reg-26",
                        time: "09.30-11.45",
                        title: "Registrazione Partecipanti",
                        room: "auditorium",
                        type: "registrazione",
                        moderators: "",
                        program: []
                    },
                    {
                        id: "corso-retention",
                        time: "10.00-11.30",
                        title: "Corso Precongressuale - La ritenzione urinaria",
                        room: "auditorium",
                        type: "workshop",
                        moderators: "Coordinatori: M. Fiori, E. Fragal√†, E. Lamanna, V. Vagnoni",
                        program: [
                            { time: "10.00", item: "RU nell'uomo - O. Saleh" },
                            { time: "10.10", item: "RU nella donna - M. Bacchiani" },
                            { time: "10.20", item: "RU nel neurologico - E. Fragal√†" },
                            { time: "10.30", item: "Approccio conservativo - L. Amaducci, A. Mazzini" }
                        ]
                    },
                    {
                        id: "inaugurazione",
                        time: "11.45-12.15",
                        title: "Inaugurazione",
                        room: "auditorium",
                        type: "sessione",
                        ecm: false,
                        moderators: "A. Giamm√≤, E. Brunocilla, E. Fragal√†, R. Gunelli, R. Schiavina",
                        program: []
                    },
                    {
                        id: "lettura-zanollo",
                        time: "12.15-12.45",
                        title: "Lettura Zanollo",
                        room: "auditorium",
                        type: "lettura",
                        ecm: false,
                        moderators: "Introduce: A. Giamm√≤",
                        program: [
                            { time: "", item: "The role and timing of urodynamics in 2025 - G. Vignoli" }
                        ]
                    },
                    {
                        id: "controversie-funzionali",
                        time: "12.45-13.30",
                        title: "Controversie Funzionali... Talk interattivo multidisciplinare",
                        room: "auditorium",
                        type: "sessione",
                        ecm: "ECM 1",
                        moderators: "Moderatore: F. Fusco",
                        program: []
                    },
                    {
                        id: "bla-bladder",
                        time: "12.45-13.30",
                        title: "Bla...Bla...Bladder and Bowel - La stitichezza √® donna",
                        room: "nettuno",
                        type: "sessione",
                        ecm: "FIO - ECM 2",
                        moderators: "Conduce: A. Cicalese",
                        program: []
                    }
                ]
            },
            {
                date: "2025-06-27",
                dayName: "Venerd√¨ 27 Giugno",
                sessions: [
                    {
                        id: "workshop-addiction-27",
                        time: "08.00-10.00",
                        title: "WORKSHOP A - Addictive lifestyle and pelvic floor dysfunction",
                        room: "napoleon",
                        type: "workshop",
                        moderators: "Coordinatori: V. Mancini, S. Musco",
                        program: [
                            { time: "08.00", item: "Alimentazione e microbiota intestinale - G. Bazzocchi" },
                            { time: "08.15", item: "Sedentariet√† - E. Bertolucci" },
                            { time: "08.30", item: "Alcol - S. Musco" }
                        ]
                    },
                    {
                        id: "workshop-incontinenza-27",
                        time: "08.00-10.00",
                        title: "WORKSHOP B - Incontinenza urinaria femminile",
                        room: "auditorium",
                        type: "workshop",
                        moderators: "Coordinatori: M. Balzarro, V. Li Marzi",
                        program: [
                            { time: "08.00", item: "Anatomia chirurgica del pavimento pelvico - G. Campagna" },
                            { time: "08.12", item: "11 sfumature di incontinenza - L. Vacca" }
                        ]
                    },
                    {
                        id: "workshop-mist-27",
                        time: "08.00-10.00",
                        title: "WORKSHOP C - Trattamenti mini invasivi per BPO (MIST)",
                        room: "nettuno",
                        type: "workshop",
                        moderators: "Coordinatori: C. De Nunzio, F. Fusco",
                        program: [
                            { time: "08.00", item: "Dalla TURP alle MIST - A. Cicione" },
                            { time: "08.15", item: "Quale MIST per quale prostata - C. De Nunzio" }
                        ]
                    },
                    {
                        id: "lettura-eau-27",
                        time: "10.00-10.30",
                        title: "Lettura EAU",
                        room: "auditorium",
                        type: "lettura",
                        moderators: "Introduce: A. Giamm√≤",
                        program: [
                            { time: "", item: "The central role of BPO in male LUTS - J. N. Cornu" }
                        ]
                    },
                    {
                        id: "chirurgia-robotica",
                        time: "11.30-12.30",
                        title: "VIDEO TALK - Chirurgia Robotica Funzionale",
                        room: "auditorium",
                        type: "sessione",
                        ecm: "ECM 1",
                        moderators: "Coordinatore: R. Schiavina",
                        program: [
                            { time: "11.30", item: "Plastica y-v nella sclerosi del collo - A. Antonelli" },
                            { time: "11.38", item: "Risultati funzionali della neovescica - P. Gontero" }
                        ]
                    },
                    {
                        id: "luts-neurodegenerative",
                        time: "11.30-12.30",
                        title: "LUTS nelle malattie neurodegenerative",
                        room: "napoleon",
                        type: "sessione",
                        ecm: false,
                        moderators: "Moderatori: P. Cortelli, C. Leone, S. Musco",
                        program: [
                            { time: "11.30", item: "Sinucleinopatie - G. Calandra Buonaura" },
                            { time: "11.45", item: "Fenotipi neurodegenerativi - G. Sampogna" }
                        ]
                    }
                ]
            },
            {
                date: "2025-06-28",
                dayName: "Sabato 28 Giugno",
                sessions: [
                    {
                        id: "assemblea-soci",
                        time: "09.00-10.00",
                        title: "Assemblea Soci SIUD",
                        room: "auditorium",
                        type: "sessione",
                        ecm: false,
                        moderators: "",
                        program: []
                    },
                    {
                        id: "spazio-fic",
                        time: "10.00-11.00",
                        title: "Spazio FIC - FIC e SIUD: insieme per una Sanit√† migliore",
                        room: "auditorium",
                        type: "sessione",
                        ecm: false,
                        moderators: "Moderatori: A. Biroli, E. Ciotti, G. Del Popolo",
                        program: [
                            { time: "10.00", item: "Introduzione - G. Del Popolo" },
                            { time: "10.10", item: "Pari opportunit√† - R. Carone" }
                        ]
                    }
                ]
            }
        ];

        let favorites = JSON.parse(localStorage.getItem('siud-favorites') || '[]');
        let currentFilters = {
            day: 'all',
            room: 'all',
            type: 'all',
            timeSlot: 'all',
            search: '',
            showOnlyFavorites: false
        };

        function initApp() {
            console.log('App inizializzata');
            populateTimeSlots();
            renderProgram();
            setupEventListeners();
            updateFavoriteButton();
        }

        function populateTimeSlots() {
            const timeSlots = new Set();
            
            programData.forEach(day => {
                day.sessions.forEach(session => {
                    timeSlots.add(session.time);
                });
            });

            const sortedTimeSlots = Array.from(timeSlots).sort();
            const timeSlotSelect = document.getElementById('timeSlotFilter');
            
            timeSlotSelect.innerHTML = '<option value="all">Tutte le fasce orarie</option>';
            
            sortedTimeSlots.forEach(timeSlot => {
                const option = document.createElement('option');
                option.value = timeSlot;
                option.textContent = timeSlot;
                timeSlotSelect.appendChild(option);
            });
        }

        function setupEventListeners() {
            console.log('Configurazione event listeners');
            
            document.getElementById('dayFilter').addEventListener('change', (e) => {
                currentFilters.day = e.target.value;
                updateTimeSlotOptions();
                renderProgram();
            });

            document.getElementById('roomFilter').addEventListener('change', (e) => {
                currentFilters.room = e.target.value;
                renderProgram();
            });

            document.getElementById('typeFilter').addEventListener('change', (e) => {
                currentFilters.type = e.target.value;
                renderProgram();
            });

            document.getElementById('timeSlotFilter').addEventListener('change', (e) => {
                currentFilters.timeSlot = e.target.value;
                renderProgram();
            });

            document.getElementById('searchInput').addEventListener('input', (e) => {
                currentFilters.search = e.target.value.toLowerCase();
                renderProgram();
            });

            document.getElementById('personalToggle').addEventListener('click', () => {
                currentFilters.showOnlyFavorites = !currentFilters.showOnlyFavorites;
                updateFavoriteButton();
                renderProgram();
            });

            document.getElementById('exportBtn').addEventListener('click', exportPersonalProgram);
        }

        function updateTimeSlotOptions() {
            const timeSlots = new Set();
            
            programData.forEach(day => {
                if (currentFilters.day !== 'all' && day.date !== currentFilters.day) {
                    return;
                }
                
                day.sessions.forEach(session => {
                    timeSlots.add(session.time);
                });
            });

            const sortedTimeSlots = Array.from(timeSlots).sort();
            const timeSlotSelect = document.getElementById('timeSlotFilter');
            const currentValue = timeSlotSelect.value;
            
            timeSlotSelect.innerHTML = '<option value="all">Tutte le fasce orarie</option>';
            
            sortedTimeSlots.forEach(timeSlot => {
                const option = document.createElement('option');
                option.value = timeSlot;
                option.textContent = timeSlot;
                timeSlotSelect.appendChild(option);
            });

            if (sortedTimeSlots.includes(currentValue)) {
                timeSlotSelect.value = currentValue;
            } else {
                timeSlotSelect.value = 'all';
                currentFilters.timeSlot = 'all';
            }
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('personalToggle');
            const exportBtn = document.getElementById('exportBtn');
            
            if (currentFilters.showOnlyFavorites) {
                btn.innerHTML = 'üìã';
                btn.style.background = '#ff6b6b';
                exportBtn.classList.remove('hidden');
            } else {
                btn.innerHTML = '‚≠ê';
                btn.style.background = '#8B1538';
                exportBtn.classList.add('hidden');
            }
        }

        function renderProgram() {
            console.log('Rendering programma');
            const container = document.getElementById('programContent');
            container.innerHTML = '';

            const filteredData = filterProgram();
            
            if (filteredData.length === 0 || filteredData.every(day => day.sessions.length === 0)) {
                container.innerHTML = '<div class="no-results">Nessun risultato trovato per i filtri selezionati.</div>';
                return;
            }

            if (currentFilters.timeSlot !== 'all') {
                renderByTimeSlot(filteredData, container);
            } else {
                renderByDay(filteredData, container);
            }
        }

        function renderByDay(filteredData, container) {
            filteredData.forEach(day => {
                if (day.sessions.length === 0) return;

                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                daySection.innerHTML = `
                    <div class="day-header">
                        <h2>${day.dayName}</h2>
                        <div class="date">${formatDate(day.date)}</div>
                    </div>
                `;

                day.sessions.forEach(session => {
                    const sessionCard = createSessionCard(session);
                    daySection.appendChild(sessionCard);
                });

                container.appendChild(daySection);
            });
        }

        function renderByTimeSlot(filteredData, container) {
            const sessionsByTimeSlot = {};
            
            filteredData.forEach(day => {
                day.sessions.forEach(session => {
                    if (!sessionsByTimeSlot[session.time]) {
                        sessionsByTimeSlot[session.time] = [];
                    }
                    sessionsByTimeSlot[session.time].push({
                        ...session,
                        dayName: day.dayName
                    });
                });
            });

            const sortedTimeSlots = Object.keys(sessionsByTimeSlot).sort();

            sortedTimeSlots.forEach(timeSlot => {
                const sessions = sessionsByTimeSlot[timeSlot];
                
                const timeSlotSection = document.createElement('div');
                timeSlotSection.className = 'day-section';
                
                const timeSlotHeader = document.createElement('div');
                timeSlotHeader.className = 'time-slot-info';
                timeSlotHeader.innerHTML = `
                    <h3>‚è∞ ${timeSlot}</h3>
                    <p>Sessioni contemporanee in ${sessions.length} sala${sessions.length > 1 ? 'e' : ''}</p>
                `;
                timeSlotSection.appendChild(timeSlotHeader);

                const concurrentContainer = document.createElement('div');
                concurrentContainer.className = 'concurrent-sessions';

                sessions.forEach(session => {
                    const sessionCard = createSessionCard(session);
                    if (currentFilters.day === 'all') {
                        const dayBadge = document.createElement('span');
                        dayBadge.className = 'session-type';
                        dayBadge.textContent = session.dayName.split(' ')[1];
                        dayBadge.style.background = '#6c757d';
                        dayBadge.style.color = 'white';
                        sessionCard.querySelector('.session-info').appendChild(dayBadge);
                    }
                    concurrentContainer.appendChild(sessionCard);
                });

                timeSlotSection.appendChild(concurrentContainer);
                container.appendChild(timeSlotSection);
            });
        }

        function filterProgram() {
            return programData.map(day => {
                if (currentFilters.day !== 'all' && day.date !== currentFilters.day) {
                    return { ...day, sessions: [] };
                }

                const filteredSessions = day.sessions.filter(session => {
                    if (currentFilters.room !== 'all' && session.room !== currentFilters.room) {
                        return false;
                    }

                    if (currentFilters.type !== 'all' && session.type !== currentFilters.type) {
                        return false;
                    }

                    if (currentFilters.timeSlot !== 'all' && session.time !== currentFilters.timeSlot) {
                        return false;
                    }

                    if (currentFilters.showOnlyFavorites && !favorites.includes(session.id)) {
                        return false;
                    }

                    if (currentFilters.search) {
                        const searchText = currentFilters.search;
                        const sessionText = `${session.title} ${session.moderators} ${session.program.map(p => p.item).join(' ')}`.toLowerCase();
                        if (!sessionText.includes(searchText)) {
                            return false;
                        }
                    }

                    return true;
                });

                return { ...day, sessions: filteredSessions };
            });
        }

        function createSessionCard(session) {
            const card = document.createElement('div');
            card.className = 'session-card';

            const isFavorite = favorites.includes(session.id);
            
            let ecmBadge = '';
            if (session.ecm) {
                ecmBadge = `<span class="session-ecm">${session.ecm}</span>`;
            }

            let programHTML = '';
            if (session.program && session.program.length > 0) {
                programHTML = `
                    <ul class="session-program">
                        ${session.program.map(item => `
                            <li>
                                <span class="program-time">${item.time}</span>
                                <span class="program-item">${item.item}</span>
                            </li>
                        `).join('')}
                    </ul>
                `;
            }

            card.innerHTML = `
                <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-session-id="${session.id}">
                    ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
                </button>
                <div class="session-header">
                    <div class="session-time">${session.time}</div>
                    <div class="session-title">${session.title}</div>
                    <div class="session-info">
                        <span class="session-room">${getRoomName(session.room)}</span>
                        <span class="session-type">${getTypeName(session.type)}</span>
                        ${ecmBadge}
                    </div>
                    ${session.moderators ? `
                        <div class="session-moderators">
                            <strong>Moderatori:</strong> ${session.moderators}
                        </div>
                    ` : ''}
                </div>
                ${programHTML ? `<div class="session-content">${programHTML}</div>` : ''}
            `;

            const favoriteBtn = card.querySelector('.favorite-btn');
            favoriteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(session.id);
            });

            return card;
        }

        function toggleFavorite(sessionId) {
            const index = favorites.indexOf(sessionId);
            if (index === -1) {
                favorites.push(sessionId);
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('siud-favorites', JSON.stringify(favorites));
            renderProgram();
        }

        function getRoomName(room) {
            const rooms = {
                'auditorium': 'Auditorium',
                'napoleon': 'Sala Napoleon',
                'nettuno': 'Sala Nettuno'
            };
            return rooms[room] || room;
        }

        function getTypeName(type) {
            const types = {
                'workshop': 'Workshop',
                'lettura': 'Lettura',
                'sessione': 'Sessione',
                'abstract': 'Abstract',
                'sponsor': 'Sponsorizzata',
                'registrazione': 'Registrazione'
            };
            return types[type] || type;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            return date.toLocaleDateString('it-IT', options);
        }

        function exportPersonalProgram() {
            const favoriteSessions = [];
            
            programData.forEach(day => {
                day.sessions.forEach(session => {
                    if (favorites.includes(session.id)) {
                        favoriteSessions.push({
                            day: day.dayName,
                            ...session
                        });
                    }
                });
            });

            if (favoriteSessions.length === 0) {
                alert('Non hai selezionato nessuna sessione per il tuo programma personale.');
                return;
            }

            let content = 'SIUD 2025 - Il Mio Programma Personale\n';
            content += '49¬∞ Congresso Nazionale SIUD\n';
            content += '23¬∞ Congresso SIUD Fisioterapisti, Infermieri, Ostetriche\n';
            content += 'Bologna, 26-28 Giugno 2025 ‚Ä¢ Hotel Savoia Regency\n\n';
            content += '=' + '='.repeat(50) + '\n\n';

            let currentDay = '';
            favoriteSessions.forEach(session => {
                if (session.day !== currentDay) {
                    currentDay = session.day;
                    content += `\n${currentDay}\n`;
                    content += '-'.repeat(currentDay.length) + '\n';
                }
                
                content += `\n‚è∞ ${session.time}\n`;
                content += `üìç ${getRoomName(session.room)}\n`;
                content += `üìã ${session.title}\n`;
                
                if (session.moderators) {
                    content += `üë• ${session.moderators}\n`;
                }
                
                if (session.program && session.program.length > 0) {
                    content += '\nProgramma:\n';
                    session.program.forEach(item => {
                        content += `  ${item.time} - ${item.item}\n`;
                    });
                }
                
                content += '\n' + '-'.repeat(40) + '\n';
            });

            content += '\n\nGenerato da SIUD 2025 App\n';
            content += new Date().toLocaleString('it-IT');

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'SIUD2025_MioProgramma.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Inizializza l'app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
